<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¨ë¼ì¸ í€´ì¦ˆ</title>
  <style>
    :root { --bg:#fafafa; --card:#fff; --ink:#111; --muted:#6b7280; --line:#e5e7eb; --ok:#065f46; --okbg:#ecfdf5; --bad:#991b1b; --badbg:#fef2f2; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif; background:var(--bg); color:var(--ink); }
    header { position:sticky; top:0; z-index:10; background:rgba(255,255,255,.9); backdrop-filter:saturate(180%) blur(10px); border-bottom:1px solid var(--line); }
    .wrap { max-width: 820px; margin: 0 auto; padding: 16px; }
    h1 { font-size: 22px; margin: 8px 0; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    button, .btn { appearance:none; border:1px solid var(--line); background:#fff; padding:8px 12px; border-radius:12px; cursor:pointer; }
    button.primary { background:#111; color:#fff; }
    button:hover, .btn:hover { background:#f5f5f5; }
    main { padding:16px; }
    .card { background:var(--card); border:1px solid var(--line); border-radius:16px; box-shadow: 0 1px 3px rgba(0,0,0,.04); padding:16px; }
    .muted { color: var(--muted); font-size: 14px; }
    .q { margin: 0 0 8px; font-weight: 600; }
    textarea, select, input[type="text"] { width:100%; padding:10px 12px; border:1px solid var(--line); border-radius:12px; background:#fff; }
    ol { list-style: none; padding:0; margin:0; }
    li + li { margin-top: 12px; }
    .badge { font-size:12px; padding:4px 8px; border-radius:8px; border:1px solid transparent; }
    .badge.ok { color:var(--ok); background:var(--okbg); border-color:#a7f3d0; }
    .badge.bad { color:var(--bad); background:var(--badbg); border-color:#fecaca; }
    details { margin-top:8px; }
    summary { cursor:pointer; }
    code { background:#f3f4f6; padding:2px 6px; border-radius:6px; }
    footer { color:var(--muted); font-size:12px; margin: 32px 0 16px; }
    .grid { display:grid; grid-template-columns: 1fr; gap:12px; }
    @media (min-width: 640px){ .grid { grid-template-columns: 1fr 1fr; } }
  </style>
</head>
<body>
  <header>
    <div class="wrap row" style="justify-content:space-between;">
      <h1>ğŸ“ ì˜¨ë¼ì¸ í€´ì¦ˆ</h1>
      <div class="row">
        <button id="btnTemplate" class="btn">JSON í…œí”Œë¦¿</button>
        <label class="btn" style="cursor:pointer;">
          í€´ì¦ˆ ì—…ë¡œë“œ
          <input id="fileInput" type="file" accept="application/json" style="display:none" />
        </label>
        <button id="btnDefault" class="btn">ê¸°ë³¸ ì„¸íŠ¸</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section id="stats" class="card" aria-live="polite">
      <div class="grid">
        <div>
          <div class="muted">ë¬¸í•­ ìˆ˜</div>
          <div id="count" style="font-weight:600;">-</div>
        </div>
        <div>
          <div class="muted">ì±„ì  ì™„ë£Œ</div>
          <div id="graded" style="font-weight:600;">-</div>
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button id="btnGradeAll" class="primary">ì „ì²´ ì±„ì </button>
        <button id="btnReset">ë¦¬ì…‹</button>
      </div>
      <div id="scoreline" class="muted" style="margin-top:8px; display:none;"></div>
    </section>

    <ol id="quizList" style="margin-top:12px;"></ol>

    <footer>
      â€¢ JSON ìŠ¤í‚¤ë§ˆ: ê° í•­ëª©ì€ <code>id</code>, <code>type</code>(ox|short|text|mc), <code>question</code>, ì •ë‹µ í•„ë“œ(<code>answer</code> | <code>acceptable</code> | <code>keywords_correct</code> | <code>acceptable_all</code>), <code>explanation</code>ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. <code>mc</code>ì¼ ë•ŒëŠ” <code>choices:[{key,text}]</code>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.<br>
      â€¢ ì •í™• ì±„ì ì´ ì¤‘ìš”í•˜ë©´ OX/ë‹¨ë‹µ/ê°ê´€ì‹ ìœ„ì£¼ë¡œ êµ¬ì„±í•˜ê±°ë‚˜ ì„ íƒì§€ë¥¼ ëª…ì‹œí•˜ì„¸ìš”. ì„œìˆ í˜•ì€ í‚¤ì›Œë“œ ê¸°ë°˜ í‰ê°€ì…ë‹ˆë‹¤.
    </footer>
  </main>

  <script>
  // ---------- ê¸°ë³¸ ë°ì´í„° (ê²°ì • íŠ¸ë¦¬ Â· ì•™ìƒë¸” Â· ì°¨ì› ì¶•ì†Œ) ----------
  const DEFAULT_QUIZ = [
    // ê¸°ì´ˆ
    { id:1, type:"short",
      question:"ê²°ì • íŠ¸ë¦¬ëŠ” ì–´ë–¤ ë‘ ê°€ì§€ ë¬¸ì œ ìœ í˜•ì— ëª¨ë‘ í™œìš©ë˜ëŠ”ê°€?",
      acceptable:["ë¶„ë¥˜ì™€ íšŒê·€","ë¶„ë¥˜ íšŒê·€","ë¶„ë¥˜, íšŒê·€","classification and regression","classification & regression"],
      canonical:"ë¶„ë¥˜ì™€ íšŒê·€",
      explanation:"ê²°ì • íŠ¸ë¦¬ëŠ” ì§€ë„í•™ìŠµì—ì„œ ë¶„ë¥˜(Classification)Â·íšŒê·€(Regression) ëª¨ë‘ì— ì‚¬ìš©ë©ë‹ˆë‹¤."
    },
    { id:2, type:"text",
      question:"ê²°ì • íŠ¸ë¦¬ì˜ êµ¬ì„±ìš”ì†Œ 3ê°€ì§€ë¥¼ ì“°ê³  ê° ì—­í• ì„ ê°„ë‹¨íˆ ì„¤ëª…í•˜ë¼.",
      keywords_correct:[
        ["ë£¨íŠ¸","root"],
        ["ë‚´ë¶€","ì˜ì‚¬","internal","decision"],
        ["ë¦¬í”„","leaf","ë‹¨ë§","terminal","ì˜ˆì¸¡"]
      ],
      explanation:"ë£¨íŠ¸ ë…¸ë“œ: ì „ì²´ ë°ì´í„° ì‹œì‘ì  / ë‚´ë¶€(ì˜ì‚¬) ë…¸ë“œ: ë¶„í•  ê¸°ì¤€ í…ŒìŠ¤íŠ¸ / ë¦¬í”„(ë‹¨ë§) ë…¸ë“œ: ë” ì´ìƒ ë¶„í• í•˜ì§€ ì•ŠëŠ” ìµœì¢… ì˜ˆì¸¡ ë…¸ë“œ."
    },
    { id:3, type:"short",
      question:"ì§€ë‹ˆ ë¶ˆìˆœë„ì˜ ì‹ì„ ê°„ë‹¨íˆ ì“°ë©´? (ê¸°í˜¸Â·ê³µë°± ììœ )",
      acceptable:["1-Î£pj^2","1 - Î£ p_j^2","1-í•©(p^2)","1- sum pj^2","1- sum of p^2"],
      canonical:"Gini = 1 âˆ’ Î£(p_j^2)",
      explanation:"ì§€ë‹ˆ ë¶ˆìˆœë„ëŠ” í´ë˜ìŠ¤ í™•ë¥ ì˜ ì œê³± í•©ì„ 1ì—ì„œ ëº€ ê°’ì…ë‹ˆë‹¤."
    },
    { id:4, type:"ox",
      question:"ì§€ë‹ˆ ë¶ˆìˆœë„ ê°’ì´ 0ì´ë©´ í•´ë‹¹ ë…¸ë“œëŠ” ì™„ì „ ìˆœìˆ˜(í•œ í´ë˜ìŠ¤ë§Œ í¬í•¨) ìƒíƒœë‹¤. (O/X)",
      answer:"O",
      explanation:"ëª¨ë“  ìƒ˜í”Œì´ ë™ì¼ í´ë˜ìŠ¤ë©´ p=1, ë‚˜ë¨¸ì§€ 0ì´ë¯€ë¡œ Î£pÂ²=1 â†’ Gini=0."
    },
    { id:5, type:"ox",
      question:"ì´ì§„ ë¶„ë¥˜ì—ì„œ ì§€ë‹ˆ ë¶ˆìˆœë„ëŠ” í´ë˜ìŠ¤ê°€ 50:50ì¼ ë•Œ ìµœëŒ€(ê°€ì¥ ë¶ˆìˆœ)ì´ë‹¤. (O/X)",
      answer:"O",
      explanation:"p=0.5,0.5ì´ë©´ Gini=1âˆ’(0.25+0.25)=0.5ë¡œ ìµœëŒ€."
    },

    // ì•™ìƒë¸”Â·ëœë¤ í¬ë ˆìŠ¤íŠ¸
    { id:6, type:"short",
      question:"ëœë¤ í¬ë ˆìŠ¤íŠ¸ê°€ ë‹¨ì¼ íŠ¸ë¦¬ ëŒ€ë¹„ ê³¼ì í•©ì— ê°•í•´ì§€ëŠ” í•µì‹¬ ì•„ì´ë””ì–´ ë‘ ê°€ì§€ëŠ”?",
      acceptable:["ë°°ê¹…ê³¼ ë¬´ì‘ìœ„ íŠ¹ì„± ì„ íƒ","ë°°ê¹…ê³¼ ëœë¤ íŠ¹ì„± ì„ íƒ","bagging and random feature selection","bootstrap and feature randomness"],
      canonical:"ë°°ê¹… + ë¬´ì‘ìœ„ íŠ¹ì„± ì„ íƒ",
      explanation:"ë¶€íŠ¸ìŠ¤íŠ¸ë© ìƒ˜í”Œë¡œ ì—¬ëŸ¬ íŠ¸ë¦¬ë¥¼ í•™ìŠµ(ë°°ê¹…)í•˜ê³ , ê° ë¶„í• ì—ì„œ ì¼ë¶€ íŠ¹ì„±ë§Œ í›„ë³´ë¡œ ì‚¬ìš©(ë¬´ì‘ìœ„ íŠ¹ì„± ì„ íƒ)."
    },
    { id:7, type:"text",
      question:"ê²°ì • íŠ¸ë¦¬ì˜ 'ë†’ì€ ë¶„ì‚°' ë¬¸ì œë¥¼ ì¤„ì´ëŠ” ëŒ€í‘œì  ë°©ë²•ê³¼ ê·¸ ì´ìœ ë¥¼ ì„¤ëª…í•˜ë¼.",
      keywords_correct:[
        ["ì•™ìƒë¸”","ëœë¤ í¬ë ˆìŠ¤íŠ¸","bagging","ë°°ê¹…"],
        ["ë¶„ì‚°","variance","ì•ˆì •ì„±","í‰ê· ","ë‹¤ìˆ˜ê²°","ìƒì‡„"]
      ],
      explanation:"ì—¬ëŸ¬ íŠ¸ë¦¬ì˜ ì˜ˆì¸¡ì„ í‰ê· /ë‹¤ìˆ˜ê²°ë¡œ ê²°í•©í•´ ê°œë³„ íŠ¸ë¦¬ì˜ ë³€ë™ì„ ìƒì‡„, ë¶„ì‚°ì„ ê°ì†Œì‹œí‚µë‹ˆë‹¤."
    },
    { id:8, type:"text",
      question:"ì•™ìƒë¸”(ë°°ê¹…/ë¶€ìŠ¤íŒ…)ì˜ ê³µí†µì  ì´ì ì„ 2ê°€ì§€ ì´ìƒ ì„œìˆ í•˜ë¼.",
      keywords_correct:[
        ["ì •í™•ë„","ì„±ëŠ¥","ê°œì„ ","í–¥ìƒ"],
        ["ë¶„ì‚°","ì•ˆì •ì„±","ê³¼ì í•©","ì¼ë°˜í™”"]
      ],
      explanation:"ì§‘ë‹¨ ì§€ì„±ìœ¼ë¡œ ì˜ˆì¸¡ ì„±ëŠ¥ í–¥ìƒ, ë¶„ì‚° ê°ì†Œ/ì•ˆì •ì„± ì¦ê°€, ê³¼ì í•© ì–µì œ ë“±ì˜ ì¥ì ."
    },

    // AdaBoost
    { id:9, type:"short",
      question:"AdaBoostì—ì„œ ì•½í•œ í•™ìŠµê¸°ì˜ ê°€ì¤‘ì¹˜(Î±)ë¥¼ ê³„ì‚°í•˜ëŠ” ê³µì‹ì˜ í˜•íƒœëŠ”? (ë¡œê·¸Â·ë¶„ìˆ˜ êµ¬ì¡°ë§Œ ë§ìœ¼ë©´ ì •ë‹µ)",
      acceptable:["0.5 ln((1-TE)/TE)","1/2 ln((1-TE)/TE)","0.5*ln((1-TE)/TE)","(1/2)ln((1-TE)/TE)"],
      canonical:"Î± = 0.5 Â· ln((1âˆ’TE)/TE)",
      explanation:"TEëŠ” ê°€ì¤‘ ì˜¤ë¥˜ìœ¨. ì •í™•ë¥ ì´ ë†’ì„ìˆ˜ë¡ Î±ê°€ ì»¤ì ¸ í•´ë‹¹ í•™ìŠµê¸°ì˜ ì˜í–¥ì´ ì»¤ì§‘ë‹ˆë‹¤."
    },
    { id:10, type:"ox",
      question:"AdaBoostì—ì„œëŠ” ì˜ëª» ë¶„ë¥˜ëœ ìƒ˜í”Œì˜ ê°€ì¤‘ì¹˜ê°€ ë‹¤ìŒ ë¼ìš´ë“œì—ì„œ ì¦ê°€í•œë‹¤. (O/X)",
      answer:"O",
      explanation:"ì˜¤ë¶„ë¥˜ ìƒ˜í”Œì— ë” í° ê°€ì¤‘ì¹˜ë¥¼ ë¶€ì—¬í•´ ë‹¤ìŒ ì•½í•œ í•™ìŠµê¸°ê°€ ê·¸ ë¶€ë¶„ì„ ë³´ì™„í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤."
    },

    // ì°¨ì› ì¶•ì†Œ ê°œë…
    { id:11, type:"text",
      question:"'ì°¨ì›ì˜ ì €ì£¼'ê°€ ëª¨ë¸ í•™ìŠµì— ë¯¸ì¹˜ëŠ” ì˜í–¥ 2ê°€ì§€ ì´ìƒì„ ì ì–´ë¼.",
      keywords_correct:[
        ["í¬ì†Œ","sparse","ë°€ë„","ë¶€í”¼"],
        ["ê³¼ì í•©","overfit","ì¼ë°˜í™” ì €í•˜"],
        ["ê³„ì‚°","ë³µì¡ë„","ì‹œê°„","ìì›"]
      ],
      explanation:"ì°¨ì›ì´ ì»¤ì§ˆìˆ˜ë¡ ë°ì´í„°ê°€ í¬ì†Œí•´ì ¸ íŒ¨í„´ í•™ìŠµì´ ì–´ë ¤ì›Œì§€ê³ , ê³¼ì í•©ê³¼ ê³„ì‚°ë¹„ìš©ì´ ì¦ê°€í•©ë‹ˆë‹¤."
    },
    { id:12, type:"ox",
      question:"ì°¨ì› ì¶•ì†Œì˜ ì£¼ìš” ëª©ì  ì¤‘ í•˜ë‚˜ëŠ” ì‹œê°í™”(2D/3D) ê°€ëŠ¥í•˜ë„ë¡ ë§Œë“œëŠ” ê²ƒì´ë‹¤. (O/X)",
      answer:"O",
      explanation:"ê³ ì°¨ì› ë°ì´í„°ë¥¼ 2D/3Dë¡œ íˆ¬ì˜í•´ ì‹œê°í™”ë¥¼ ë•ëŠ” ê²ƒì´ ëŒ€í‘œ ëª©ì  ì¤‘ í•˜ë‚˜ì…ë‹ˆë‹¤."
    },

    // PCA
    { id:13, type:"text",
      question:"PCA ì ˆì°¨ë¥¼ ìˆœì„œëŒ€ë¡œ í•µì‹¬ í‚¤ì›Œë“œë¡œ ìš”ì•½í•˜ë¼.",
      keywords_correct:[
        ["í‘œì¤€í™”","ìŠ¤ì¼€ì¼"],
        ["ê³µë¶„ì‚°","covariance"],
        ["ê³ ìœ ê°’","ê³ ìœ ë²¡í„°","eigen"],
        ["ì •ë ¬","ì„ íƒ","ì£¼ì„±ë¶„","PC"],
        ["íˆ¬ì˜","project","ë³€í™˜"]
      ],
      explanation:"(1)í‘œì¤€í™” â†’ (2)ê³µë¶„ì‚° í–‰ë ¬ â†’ (3)ê³ ìœ ë¶„í•´ â†’ (4)í° ê³ ìœ ê°’ ìˆœ ì£¼ì„±ë¶„ ì„ íƒ â†’ (5)ì£¼ì„±ë¶„ ì¶•ìœ¼ë¡œ íˆ¬ì˜."
    },
    { id:14, type:"text",
      question:"PCAì—ì„œ ê³ ìœ ë²¡í„°ì™€ ê³ ìœ ê°’ì´ ê°ê° ì˜ë¯¸í•˜ëŠ” ë°”ë¥¼ ì„¤ëª…í•˜ë¼.",
      keywords_correct:[
        ["ë°©í–¥","ì¶•","ë²¡í„°","ì£¼ì„±ë¶„"],
        ["ë¶„ì‚°","ì„¤ëª…ë ¥","í¬ê¸°","ê³ ìœ ê°’"]
      ],
      explanation:"ê³ ìœ ë²¡í„°ëŠ” ì£¼ì„±ë¶„ì˜ ë°©í–¥, ê³ ìœ ê°’ì€ í•´ë‹¹ ë°©í–¥ì˜ ë¶„ì‚°(ì„¤ëª…ë ¥)ì˜ í¬ê¸°ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤."
    },

    // t-SNE vs UMAP & ê°ê´€ì‹ ì¶”ê°€
    { id:15, type:"text",
      question:"t-SNEì™€ UMAPì„ ë¹„êµí•˜ì—¬ UMAPì˜ ì¥ì ì„ 2ê°€ì§€ ì´ìƒ ì„œìˆ í•˜ë¼.",
      keywords_correct:[
        ["ì „ì—­","global","êµ¬ì¡°","ë³´ì¡´"],
        ["ì†ë„","ë¹ ë¥´","scal","ëŒ€ìš©ëŸ‰"]
      ],
      explanation:"UMAPì€ ì „ì—­/ì§€ì—­ êµ¬ì¡°ë¥¼ ë¹„êµì  ì˜ ë³´ì¡´í•˜ê³ , t-SNE ëŒ€ë¹„ ë¹ ë¥´ë©° ëŒ€ìš©ëŸ‰ì—ë„ ìœ ë¦¬í•©ë‹ˆë‹¤."
    },

    /* ìƒˆ ê°ê´€ì‹ 1 */
    { id:16, type:"mc",
      question:"ëœë¤ í¬ë ˆìŠ¤íŠ¸ì—ì„œ \"ë°°ê¹…(Bagging)\"ì´ë€ ë¬´ì—‡ì¸ê°€?",
      choices:[
        { key:"a", text:"ëª¨ë¸ì„ ì§ë ¬ë¡œ í•™ìŠµì‹œí‚¤ëŠ” ë°©ì‹" },
        { key:"b", text:"ë°ì´í„°ì…‹ì—ì„œ ì¤‘ë³µ í—ˆìš© ìƒ˜í”Œë§ìœ¼ë¡œ ì—¬ëŸ¬ ë°ì´í„°ì…‹ì„ ìƒì„±í•˜ëŠ” ë°©ë²•" },
        { key:"c", text:"ëª¨ë“  íŠ¹ì„±ì„ ê³ ë ¤í•´ ë¶„í•  ê¸°ì¤€ì„ ì°¾ëŠ” ë°©ë²•" },
        { key:"d", text:"ë°ì´í„°ì˜ ì°¨ì›ì„ ì¶•ì†Œí•˜ëŠ” ë°©ë²•" }
      ],
      answer:"b",
      explanation:"ë°°ê¹…(ë¶€íŠ¸ìŠ¤íŠ¸ë© ì• ê·¸ë¦¬ê²Œì´íŒ…)ì€ ë¶€íŠ¸ìŠ¤íŠ¸ë© ìƒ˜í”Œë¡œ ì—¬ëŸ¬ í•™ìŠµê¸°ë¥¼ ë³‘ë ¬ í•™ìŠµí•œ ë’¤ í‰ê· /ë‹¤ìˆ˜ê²°ë¡œ ê²°í•©í•˜ëŠ” ê¸°ë²•ì…ë‹ˆë‹¤."
    },

    /* ìƒˆ ê°ê´€ì‹ 2 */
    { id:17, type:"mc",
      question:"ì°¨ì› ì¶•ì†Œê°€ í•„ìš”í•œ ì´ìœ ë¡œ ì ì ˆí•˜ì§€ ì•Šì€ ê²ƒì€ ë¬´ì—‡ì¸ê°€?",
      choices:[
        { key:"a", text:"ë°ì´í„°ì˜ í¬ì†Œì„± ë¬¸ì œ ì™„í™”" },
        { key:"b", text:"ê³¼ì í•© ë°©ì§€" },
        { key:"c", text:"ëª¨ë¸ í•™ìŠµ ì†ë„ í–¥ìƒ" },
        { key:"d", text:"ë°ì´í„° ë ˆì´ë¸” ìƒì„±" }
      ],
      answer:"d",
      explanation:"ì°¨ì› ì¶•ì†ŒëŠ” ì‹œê°í™”Â·ê³¼ì í•© ì™„í™”Â·ê³„ì‚° íš¨ìœ¨ í–¥ìƒ ë“±ì— ìœ ìš©í•˜ì§€ë§Œ, ë ˆì´ë¸”ì„ ìƒì„±í•˜ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤."
    }
  ];

  // ---------- ìƒíƒœ ----------
  let quiz = JSON.parse(localStorage.getItem('quiz-data') || 'null') || DEFAULT_QUIZ;
  let answers = JSON.parse(localStorage.getItem('quiz-answers') || '{}');
  let results = {}; // {id: {correct, feedback}}
  let gradedAll = false;

  // ---------- ìœ í‹¸ ----------
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const norm = (s) => (s ?? '').toString().trim().toLowerCase();

  function setStat() {
    $('#count').textContent = quiz.length;
    const done = Object.values(results).filter(Boolean).length;
    $('#graded').textContent = `${done} / ${quiz.length}`;
    if (gradedAll) {
      const correct = Object.values(results).filter(r => r && r.correct).length;
      const pct = quiz.length ? Math.round((correct / quiz.length) * 100) : 0;
      const line = `ì ìˆ˜: ${correct} / ${quiz.length} (${pct}%)`;
      const el = $('#scoreline');
      el.textContent = line;
      el.style.display = 'block';
    } else {
      $('#scoreline').style.display = 'none';
    }
  }

  function persist() {
    localStorage.setItem('quiz-data', JSON.stringify(quiz));
    localStorage.setItem('quiz-answers', JSON.stringify(answers));
  }

  // ---------- ì±„ì  ë¡œì§ ----------
  function checkOX(item, user) {
    const u = norm(user);
    const a = norm(item.answer);
    const correct = u === a || (u === 'o' && a.startsWith('o')) || (u === 'x' && a.startsWith('x'));
    return { correct, feedback: correct ? 'ì •ë‹µ' : `ì˜¤ë‹µ (ì •ë‹µ: ${item.answer})` };
  }

  function checkMC(item, user) {
    const u = norm(user);
    if (!u) return { correct:false, feedback:'ë¯¸ì‘ë‹µ: ë³´ê¸°ë¥¼ ì„ íƒí•˜ì„¸ìš”' };
    const correct = u === norm(item.answer);
    const choiceMap = Object.fromEntries((item.choices || []).map(c => [norm(c.key), c.text]));
    const right = `${item.answer}) ${choiceMap[norm(item.answer)] ?? ''}`.trim();
    return { correct, feedback: correct ? 'ì •ë‹µ' : `ì˜¤ë‹µ (ì •ë‹µ: ${right})` };
  }

  function checkShort(item, user) {
    const u = norm(user);
    if (!u) {
      return { correct: false, feedback: 'ë¯¸ì‘ë‹µ: ë‹µì„ ì…ë ¥í•´ ì£¼ì„¸ìš”' };
    }
    const acc = (item.acceptable || []).map(norm);
    const correct = acc.some(a =>
      u === a ||
      u.replace(/\s+/g, '') === a.replace(/\s+/g, '') ||
      u.includes(a)
    );
    const ans = item.canonical || acc[0] || '';
    return { correct, feedback: correct ? 'ì •ë‹µ' : `ì˜¤ë‹µ (í‚¤ì›Œë“œ ì˜ˆ: ${ans})` };
  }

  function checkText(item, user) {
    const groups = item.keywords_correct || [];
    const u = norm(user);
    const correct = groups.every(group => group.some(kw => u.includes(norm(kw))));
    let need = groups.map(group => (group.find(kw => u.includes(norm(kw))) ? null : `â€¢ ${group.join(', ')}`)).filter(Boolean).join('\n');
    const feedback = correct ? 'í•µì‹¬ í¬ì¸íŠ¸ ì¶©ì¡±' : `ë¶€ì¡±í•œ í‚¤ì›Œë“œ:\n${need}`;
    return { correct, feedback };
  }

  function checkAllRequired(item, user) { // acceptable_all ì „ìš©
    const u = norm(user);
    const required = (item.acceptable_all || []).map(norm);
    const missing = required.filter(k => !u.includes(k));
    const correct = missing.length === 0;
    const feedback = correct ? 'ì •ë‹µ' : `ëˆ„ë½: ${missing.join(', ')}`;
    return { correct, feedback };
  }

  function checkOne(item, user) {
    if (item.type === 'ox') return checkOX(item, user);
    if (item.type === 'mc') return checkMC(item, user);
    if (item.type === 'short') return (item.acceptable_all ? checkAllRequired(item, user) : checkShort(item, user));
    return checkText(item, user);
  }

  // ---------- ë Œë” ----------
  function render() {
    const list = $('#quizList');
    list.innerHTML = '';
    quiz.forEach(item => {
      const li = document.createElement('li');
      li.className = 'card';

      const q = document.createElement('p');
      q.className = 'q';
      q.textContent = `${item.id}. ${item.question}`;
      li.appendChild(q);

      let inputEl;
      if (item.type === 'ox') {
        inputEl = document.createElement('select');
        inputEl.innerHTML = '<option value="">ì„ íƒ</option><option value="O">O</option><option value="X">X</option>';
        inputEl.value = answers[item.id] ?? '';
        inputEl.addEventListener('input', (e) => handleInput(item, e.target.value, li));
        li.appendChild(inputEl);
      } else if (item.type === 'mc') {
        const wrap = document.createElement('div');
        (item.choices || []).forEach(ch => {
          const id = `q${item.id}_${ch.key}`;
          const label = document.createElement('label');
          label.className = 'row';
          label.style.alignItems = 'center';
          label.style.gap = '6px';
          label.htmlFor = id;

          const radio = document.createElement('input');
          radio.type = 'radio';
          radio.name = `mc_${item.id}`;
          radio.id = id;
          radio.value = ch.key;
          radio.checked = (answers[item.id] ?? '') === ch.key;

          radio.addEventListener('change', (e) => handleInput(item, e.target.value, li));

          const span = document.createElement('span');
          span.textContent = `${ch.key}) ${ch.text}`;

          label.appendChild(radio);
          label.appendChild(span);
          wrap.appendChild(label);
        });
        li.appendChild(wrap);
      } else {
        inputEl = document.createElement('textarea');
        inputEl.placeholder = item.type === 'short' ? 'ì •ë‹µ(ë‹¨ë‹µ) ì…ë ¥' : 'í•µì‹¬ í‚¤ì›Œë“œë¥¼ í¬í•¨í•´ ì„œìˆ í•˜ì„¸ìš”';
        inputEl.rows = 4;
        inputEl.value = answers[item.id] ?? '';
        inputEl.addEventListener('input', (e) => handleInput(item, e.target.value, li));
        li.appendChild(inputEl);
      }

      const actionRow = document.createElement('div');
      actionRow.className = 'row';
      actionRow.style.marginTop = '8px';

      const btn = document.createElement('button');
      btn.textContent = 'ì±„ì ';
      btn.addEventListener('click', () => {
        const r = checkOne(item, answers[item.id]);
        results[item.id] = r;
        renderRowFooter(li, item);
        setStat();
      });
      actionRow.appendChild(btn);

      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.style.display = 'none';
      badge.id = `badge-${item.id}`;
      actionRow.appendChild(badge);

      li.appendChild(actionRow);

      const fbWrap = document.createElement('div');
      fbWrap.id = `fb-${item.id}`;
      fbWrap.style.marginTop = '8px';
      li.appendChild(fbWrap);

      list.appendChild(li);

      renderRowFooter(li, item);
    });

    setStat();
  }

  function handleInput(item, value, li) {
    answers[item.id] = value;
    results[item.id] = undefined; // ì…ë ¥ ì‹œ ì´ì „ ì±„ì  ë¦¬ì…‹
    gradedAll = false;
    persist();
    setStat();
    renderRowFooter(li, item);
  }

  function renderRowFooter(li, item) {
    const r = results[item.id];
    const badge = li.querySelector(`#badge-${item.id}`);
    const fb = li.querySelector(`#fb-${item.id}`);

    if (r) {
      badge.style.display = 'inline-block';
      badge.textContent = r.correct ? 'ì •ë‹µ' : 'ì˜¤ë‹µ';
      badge.className = `badge ${r.correct ? 'ok' : 'bad'}`;

      fb.innerHTML = '';
      const p = document.createElement('p');
      p.className = 'muted';
      p.style.whiteSpace = 'pre-wrap';
      p.innerHTML = `<strong>í”¼ë“œë°±:</strong> ${r.feedback}`;
      fb.appendChild(p);

      if (item.explanation) {
        const det = document.createElement('details');
        const sum = document.createElement('summary');
        sum.textContent = 'í•´ì„¤ ë³´ê¸°';
        det.appendChild(sum);
        const box = document.createElement('div');
        box.className = 'card';
        box.style.marginTop = '6px';
        box.textContent = item.explanation;
        det.appendChild(box);
        fb.appendChild(det);
      }
    } else {
      badge.style.display = 'none';
      fb.innerHTML = '';
    }
  }

  // ---------- ì´ë²¤íŠ¸ ë°”ì¸ë”© ----------
  $('#btnGradeAll').addEventListener('click', () => {
    results = {};
    quiz.forEach(q => { results[q.id] = checkOne(q, answers[q.id]); });
    gradedAll = true;
    render();
  });

  $('#btnReset').addEventListener('click', () => {
    answers = {};
    results = {};
    gradedAll = false;
    persist();
    render();
  });

  $('#btnDefault').addEventListener('click', () => {
    quiz = JSON.parse(JSON.stringify(DEFAULT_QUIZ));
    answers = {};
    results = {};
    gradedAll = false;
    persist();
    render();
  });

  $('#fileInput').addEventListener('change', async (e) => {
    const file = e.target.files && e.target.files[0];
    if (!file) return;
    try {
      const text = await file.text();
      const data = JSON.parse(text);
      if (!Array.isArray(data)) throw new Error('JSONì€ ë°°ì—´ì´ì–´ì•¼ í•©ë‹ˆë‹¤.');
      data.forEach((d, i) => {
        if (d == null || typeof d !== 'object') throw new Error(`${i+1}ë²ˆì§¸ í•­ëª©ì´ ê°ì²´ê°€ ì•„ë‹™ë‹ˆë‹¤.`);
        if (d.id == null || !d.question) throw new Error(`${i+1}ë²ˆì§¸ í•­ëª©: id/question ëˆ„ë½`);
        if (!['ox','short','text','mc'].includes(d.type)) throw new Error(`${i+1}ë²ˆì§¸ í•­ëª©: ì§€ì›í•˜ì§€ ì•ŠëŠ” type`);
      });
      quiz = data;
      answers = {};
      results = {};
      gradedAll = false;
      persist();
      render();
    } catch (err) {
      alert('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + err.message);
    } finally {
      e.target.value = '';
    }
  });

  $('#btnTemplate').addEventListener('click', () => {
    const template = [
      { id:1, type:'ox', question:'ì˜ˆ) íŒŒì´ì¬ì€ ì¸í„°í”„ë¦¬í„° ì–¸ì–´ë‹¤. (O/X)', answer:'O', explanation:'ê°„ë‹¨ ì„¤ëª…' },
      { id:2, type:'short', question:'ì˜ˆ) os ëª¨ë“ˆë¡œ í˜„ì¬ ë””ë ‰í† ë¦¬ êµ¬í•˜ëŠ” í•¨ìˆ˜?', acceptable:['os.getcwd','getcwd','os.getcwd()'], canonical:'os.getcwd()', explanation:'ì •ë‹µ/ì„¤ëª…' },
      { id:3, type:'text', question:'ì˜ˆ) from X import * ì˜ ì¥ë‹¨ì ?', keywords_correct:[["ì¥ì ","ê°„í¸"],["ë‹¨ì ","ë„¤ì„ìŠ¤í˜ì´ìŠ¤","ì˜¤ì—¼","ì¶©ëŒ"]], explanation:'í‚¤ì›Œë“œ ê¸°ì¤€ ì±„ì ' },
      { id:4, type:'mc', question:'ì˜ˆ) ë¨¸ì‹ ëŸ¬ë‹ ì§€ë„í•™ìŠµ ë¬¸ì œ ìœ í˜•ì€?', choices:[{key:'a',text:'ë¶„ë¥˜/íšŒê·€'},{key:'b',text:'í´ëŸ¬ìŠ¤í„°ë§/ì°¨ì›ì¶•ì†Œ'}], answer:'a', explanation:'ì§€ë„í•™ìŠµì€ ë¶„ë¥˜/íšŒê·€ê°€ ëŒ€í‘œì .' }
    ];
    const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'quiz_template.json';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  // ì´ˆê¸° ë Œë”
  render();
  </script>
</body>
</html>
